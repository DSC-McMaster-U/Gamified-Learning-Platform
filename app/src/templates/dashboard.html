{% extends "base.html" %} 
{% block title %}Dashboard{% endblock %} 

{% block styling %}
<!-- Local stylesheets -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
{% endblock %} 

{% block scripts %}
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    const pointsPanel = document.querySelector("#dashboard-heading .points");
    
    // User stats
    function userStats() {
        $.ajax({
            url: "/user_points",
            method: "GET",
            success: function (data) {
                $("#pointsDisplay").text(data.points);
            },
            error: function (error) {
                console.error("Error fetching user stats:", error);
            },
        });
    }

    $(document).ready(function () {
        if (document.querySelector(".dropdown-subtitle").textContent.trim() == "Student") {
            userStats();

            // Update every 20 seconds
            setInterval(userStats, 20000);
        } else {
            pointsPanel.querySelector("#pointsDisplay").textContent = "0";
        }
    });

    window.addEventListener("DOMContentLoaded", () => {
        if (sessionStorage.getItem("signUpInfo") != null) {
            sessionStorage.removeItem("signUpInfo");
        }
    })
</script>
{% endblock %}

{% block content %}
<main>
    <div id="heading">
        <h1>Welcome to your Dashboard, {{ current_user.username }}</h1>
    </div>

    <div id="dashboard-container">
        <div id="dashboard-heading">
            <div class="points">
                <!-- Replace with actual points count later, user points from model -->
                <img
                    id="points-logo-img"
                    src="../static/vendor/images/dashboard/points-logo.png"
                    alt=""
                />
                <span class="number-points" id="pointsDisplay">500</span>
            </div>
            <div id="user-level">
                <div id="level-progress-container">
                    <label for="progress-bar">Level 1</label>
                    <progress id="progress-bar" value="250" max="1000"></progress>
                </div>
                <div id="xp-container">
                    <p id="xp-space"></p>
                    <p id="remaining-xp">750 more XP until next level!</p> 
                </div>
            </div>
        </div>

        <div id="cards-container">
            <div class="card">
                <div class="card-body1">
                    <div id="left-side-content">
                        <h4>Learn</h4>
                        <div id="unit-progress">
                            <p id="unit-number">UNIT 1:</p>
                            <!-- replace with actual lesson progress -->
                            <p id="current-lesson">2/4</p>
                        </div>
                        <!-- <a href="{{ current_lesson_url }}" id="continue-lesson-link">
                            
                        </a> -->
                        <!-- put the button line inside the <a> tag above after we set up the dashboard route to send in 
                            the user's current lesson url (need to update the route in main.py/update models?) -->
                        
                        <!-- V  Due to the lack of time, this is a link directing to a placeholder lesson...  V -->
                        <a href="/lesson/1" id="continue-lesson-link">
                            <button id="continue-lesson">CONTINUE</button>
                        </a>
                    </div>
                    <div id="circular-progress-bar">
                        <!-- use inline style to set the progress value after setting up models to get percentage (create conic gradient here and not in css) -->
                        <div id="inner-circle"></div>
                        <!-- replace percentage with actual progress after -->
                        <p id="percentage">50%</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body2">
                    <div id="challenge-card-header">
                        <h4>Daily Challenge</h4>
                        <img
                        id="challenge-icon-img"
                        src="../static/vendor/images/dashboard/challenge_icon.png"
                        alt=""
                        />
                    </div>
                    <p class="card-caption">Solve exciting daily challenges for points!</p>
                    <a id="challenge-button" onclick="alert('This feature will be implemented in the future!')">
                        <div class="button-content">
                            <span class="button-content-text">Factors and Multiples</span>
                            <span id="challenge-question">Number of CDs in Box</span>
                            <div class="points">
                                <!-- Replace with actual points count later, user points from model -->
                                <img
                                    id="points-logo-img"
                                    src="../static/vendor/images/dashboard/points-logo.png"
                                    alt=""
                                />
                                <span class="number-points">1000</span>
                            </div>
                        </div>
                    </a>
                    <!-- add in href="{{ challenge_page_url }}" to the <a> tag after we set up the dashboard route to send in 
                        the daily challenge page url (need to update the route in main.py/update models?) -->
                    <!-- add in specific data using Jinja for the challenge topic, question, and points amount after -->
                </div>
            </div>
    
            <div class="card">
                <div class="card-body2">
                    <h4>Test Yourself!</h4>
                    <p class="card-caption">Continue where you left off. Click to begin.</p>
                    <a id="continue-quizzes-button" href="/quiz/0" style="text-decoration: none;">
                        <div class="button-content-left-align">
                            <!-- add in icon for each quiz unit later? -->
                            <span class="button-content-text">Unit 1: Prime Factorization</span>
                            <div id="quiz-information">
                                <span id="quiz-difficulty">Difficulty: Medium</span>
                                <div class="points">
                                    <!-- Replace with actual points count later, user points from model -->
                                    <img
                                        id="points-logo-img"
                                        src="../static/vendor/images/dashboard/points-logo.png"
                                        alt=""
                                    />
                                    <span class="number-points">100</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
    
            <div class="card">
                <div class="card-body3">
                    <div id="leaderboard-card-header">
                        <h4>Weekly Leaderboard</h4>
                        <button id="view-leaderboard" onclick="window.location.href='/leaderboard'">VIEW ALL</button>
                    </div>
                    <ul id="leaderboard-list">
                        {% for i, user in enumerate(leaderboard_data[:5]) %}
                        <li class="leaderboard-entry">
                            <span class="leaderboard-rank">{{ i + 1 }}</span>
                            <span class="leaderboard-name">{{ user.username }}</span>
                            <span class="leaderboard-points">{{ user.points.points }} XP</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            
        </div>
        
        <!-- Quiz Scores Section -->
        <div id="quiz-scores-section">
            <h2>Your Quiz Scores</h2>
            <div id="quiz-scores-container">
                <!-- Example quiz score entries -->
                <div class="quiz-score-item">
                    <div class="quiz-title">Mathematics Quiz - Algebra</div>
                    <div class="quiz-score">Score: 85%</div>
                </div>
                <div class="quiz-score-item">
                    <div class="quiz-title">Science Quiz - Chemistry</div>
                    <div class="quiz-score">Score: 90%</div>
                </div>
                <div class="quiz-score-item">
                    <div class="quiz-title">History Quiz - Ancient Civilizations</div>
                    <div class="quiz-score">Score: 78%</div>
                </div>
                <!-- More quiz score entries can be added here -->
            </div>
        </div>

        <!-- May need to take different approach for streak tracker, a bit complicated because we need to make sure month labels align with the
        right columns based on the specific year and also shade in the correct boxes based on the date -->
        <div id="streak-tracker">
            <span id="tracker-title">Streak Tracker</span>
            <div class="month-labels">
                <!-- Add individual month labels here -->
                <span>Jan</span>
                <span>Feb</span>
                <span>Mar</span>
                <span>Apr</span>
                <span>May</span>
                <span>Jun</span>
                <span>Jul</span>
                <span>Aug</span>
                <span>Sep</span>
                <span>Oct</span>
                <span>Nov</span>
                <span>Dec</span>
            </div>
            <div class="days-grid">
                <!-- Create enough divs to represent all days across the year -->
                {% for week in range(53) %} <!-- Adjust if your year starts in the middle of a week -->
                    <div class="week">
                        {% for day in range(7) %}
                        <!-- Just set a couple tiles green for now, set up Jinja2 to update tile colour based on user activity sent in after -->
                            {% if loop.index0 == 1 and week == 1 %}
                                <div class="day active"></div>
                            {% elif loop.index0 == 3 and week == 2 %}
                                <div class="day active"></div>
                            {% else %}
                                <div class="day"></div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
            <div id="activity-legend">
                <div class="legend-item">
                    <span id="activity-label">Activity</span>
                    <div class="legend-color" style="background-color: #ffffff;"></div>
                    <div class="legend-color" style="background-color: #32cd32;"></div>
                </div>
                <span id="current-streak">Current Streak: 1 day</span>
                <span id="longest-streak">Longest Streak: 1 day</span>
            </div>
        </div>           
    </div>
</main>
{% endblock %}
 